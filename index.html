<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CD Player Funcional</title>
</head>
<body>

<div id="cdPlayerWindow" class="window" style="width:320px">
    <div class="title-bar">
        <div class="title-bar-text">
            <img src="https://images2.imgbox.com/42/89/JIRoQjUo_o.png"/>
            CD Player
        </div>
        <div class="title-bar-controls"></div>
    </div>
    <div class="window-body">
        <div class="toptoptop">
            <div class="menu-item">
                <span><u>D</u>isc</span>
                <ul class="dropdown-menu">
                    <li id="menuEject">Eject</li>
                    <li id="menuAddMusic"><u>A</u>dicionar Música</li>
                </ul>
            </div>
            <div class="menu-item">
                <span><u>V</u>iew</span>
                <ul class="dropdown-menu">
                    <li id="menuViewNormal">Normal</li>
                    <li id="menuViewCompact">Compact</li>
                    <li class="separator"></li>
                    <li id="menuViewVolume">Volume Control</li>
                </ul>
            </div>
            <div class="menu-item">
                <span><u>O</u>ptions</span>
                <ul class="dropdown-menu">
                    <li id="menuOptRandom"><span class="checkmark"></span>Random Order</li>
                    <li id="menuOptContinuous"><span class="checkmark active">✓</span>Continuous Play</li>
                    <li class="separator"></li>
                    <li id="menuOptPrefs">Preferences...</li>
                </ul>
            </div>
        </div>

        <p id="text2">[00] 00:00</p>
        <div class="buttontos">
            <p id="playButton" class="control-butt">▶</p>
            <p id="pauseButton" class="control-butt">❚❚</p>
            <p id="stopButton" class="control-butt"><span>◼</span></p>
            <p id="previousTrackButton" class="control-butt">❚◄◄</p>
            <p id="rewindButton" class="control-butt">◄◄</p>
            <p id="forwardButton" class="control-butt">►►</p>
            <p id="nextTrackButton" class="control-butt">►►❚</p>
            <p id="ejectButton" class="control-butt"><span>❚ ►</span></p>
        </div>

        <div class="volume-control">
            <label for="volumeSlider">Volume</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
        </div>
        
        <div class="ahhh">
            <p id="label"><u>A</u>rtist:</p>
            <p id="text" class="artist"></p>
            <p id="label">Title:</p>
            <p id="text" class="title"></p>
        </div>
    </div>
    <div class="status-bar">
        <p class="status-bar-field">Total Play: 00:00 m:s</p>
        <p class="status-bar-field">Track: 00:00 m:s</p>
    </div>
</div>

<input type="file" id="fileInput" accept="audio/*" style="display:none;">

<style>
    :root {
        --artist: "Devon Hendryx";
        --title: "Missing Image File";
        --albumcover: url(https://m.media-amazon.com/images/I/71NmRa8Sp7L._AC_SL1500_.jpg);
    }
    
    .status-bar, .title-bar { display: flex; }
    .window { background: silver; margin: auto; text-shadow: none; box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #dfdfdf, inset -2px -2px grey, inset 2px 2px #fff; padding: 3px; color: #000!important; font-family: "Pixelated MS Sans Serif"!important; transition: width 0.2s ease-in-out; }
    .window * { -webkit-font-smoothing: none; font-family: "Pixelated MS Sans Serif", Arial; font-size: 11px; text-shadow: inherit; }
    .window img { filter: none!important; }
    p#text, p#text2 { box-shadow: inset -1px -1px #fff, inset 1px 1px grey, inset -2px -2px #dfdfdf, inset 2px 2px #0a0a0a; box-sizing: border-box; margin-block: 3px; }
    .control-butt, p#text, p#text2 { box-sizing: border-box; }
    p#label, p#text, p#text2 { margin-block: 3px; }
    .status-bar, .title-bar-text, .toptoptop, .control-butt, p#label, p#text2 { user-select: none; }
    
    @font-face { font-family: "Pixelated MS Sans Serif"; font-style: normal; font-weight: 400; src: url(https://unpkg.com/98.css@0.1.20/dist/ms_sans_serif.woff) format("woff"), url(https://unpkg.com/98.css@0.1.20/dist/ms_sans_serif.woff2) format("woff2"); }
    @font-face { font-family: "Pixelated MS Sans Serif"; font-style: normal; font-weight: 700; src: url(https://unpkg.com/98.css@0.1.20/dist/ms_sans_serif_bold.woff) format("woff"), url(https://unpkg.com/98.css@0.1.20/dist/ms_sans_serif_bold.woff2) format("woff2"); }

    .title-bar { align-items: center; background: linear-gradient(90deg, navy, #1084d0); justify-content: space-between; padding: 2px; }
    .title-bar-text { color: #fff; font-weight: 700; letter-spacing: 0; margin-right: 24px; line-height: 15px; }
    .title-bar-text img { vertical-align: bottom; margin-inline: 2px; }
    .title-bar-controls { display: none; }
    .window-body { margin: 8px; }

    /* --- ESTILOS DOS MENUS --- */
    .toptoptop { display: flex; text-align: left; margin-top: -3px !important; margin-bottom: 5px !important; margin-inline: 0px !important; position: relative; }
    .menu-item { position: relative; }
    .menu-item > span { border: 1px solid silver; padding: 2px 4px; cursor: pointer; }
    .dropdown-menu { display: none; position: absolute; top: 100%; left: 0; background: silver; box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff, inset -2px -2px grey, inset 2px 2px #dfdfdf; border: 1px solid silver; padding: 2px; margin: 0; list-style: none; min-width: 120px; z-index: 1000; }
    .menu-item.active .dropdown-menu { display: block; }
    .menu-item > span.active { background: #e6e6e6; border: 1px dotted black; }
    .dropdown-menu li { padding: 3px 10px 3px 20px; cursor: pointer; white-space: nowrap; position: relative; }
    .dropdown-menu li:hover { background-color: navy; color: white; }
    .dropdown-menu li.separator { height: 1px; background-color: grey; margin: 4px 1px; box-shadow: 1px 1px #fff; padding: 0; cursor: default; }
    .dropdown-menu li:hover.separator { background: grey; } /* Evita o highlight azul */
    .checkmark { display: inline-block; width: 15px; text-align: left; position: absolute; left: 3px; top: 3px; }
    .checkmark.active { content: '✓'; }

    /* Display de tempo e imagem */
    p#text2 { position: relative; display: inline-block; padding: 13px 4px; width: 54%; font-size: 20px; text-align: center; color: rgb(253, 253, 4); background: #000; z-index: 1; }
    p#text2:before { content: ""; display: block; position: absolute; top: 1px; left: 1px; background-image: var(--albumcover); width: 98%; height: 96%; opacity: .5; background-size: cover; background-position: center; z-index: -1; }

    .buttontos { display: inline-block; width: 45%; height: 54px; vertical-align: top; text-align: center; }
    .control-butt { display: inline-block; border: none; border-radius: 0; background: silver; min-height: 23px; min-width: 20px; max-width: 20px; margin: 2px; padding: 6px 0; box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff, inset -2px -2px grey, inset 2px 2px #dfdfdf; color: #000; text-shadow: 1px 1px #fff; line-height: 10px; cursor: pointer; font-size: 12px; white-space: nowrap; }
    .control-butt:active { box-shadow: inset -1px -1px #fff, inset 1px 1px #0a0a0a, inset -2px -2px #dfdfdf, inset 2px 2px grey; text-shadow: 1px 1px #222; }
    .control-butt:focus { outline: #000 dotted 1px; outline-offset: -4px; }
    #playButton { min-width: 75px; } #pauseButton, #stopButton { text-indent: -5px; font-weight: 700; } #stopButton span { display: block; transform: translate(2px, -2px) scale(1.2); } #previousTrackButton, #rewindButton, #forwardButton, #nextTrackButton { text-indent: -8px; font-weight: 700; letter-spacing: -4px; font-size: 10px; } #ejectButton { text-indent: -8px; font-weight: 700; letter-spacing: -1.5px; text-shadow: none; transform: translateY(1px); } #ejectButton span { display: block; transform: rotate(-90deg) translate(2px, 0) scaleY(1.4); color: #000; }
    
    /* --- ESTILOS DE FUNCIONALIDADES --- */
    .ahhh { text-align: right; }
    .volume-control { display: none; margin-top: 5px; } /* Controle de volume escondido */
    .volume-control.active { display: block; text-align: center; padding: 5px 0; } /* Mostra o controle */
    .window.compact { width: 180px !important; } /* Visão compacta */
    .window.compact .ahhh, .window.compact .status-bar { display: none; }
    .window.compact p#text2 { width: 98%; }
    .window.compact .buttontos { width: 98%; height: auto; }

    /* --- ESTILO RETRÔ PARA O CONTROLE DE VOLUME (NOVO) --- */
    #volumeSlider {
        -webkit-appearance: none;
        appearance: none;
        width: 80%;
        height: 20px;
        background: transparent;
        outline: none;
    }
    #volumeSlider::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: silver;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #fff;
        border-left: 1px solid grey;
        border-top: 1px solid grey;
        box-shadow: inset 1px 1px 0px #0a0a0a;
    }
    #volumeSlider::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 15px;
        background: silver;
        cursor: pointer;
        margin-top: -8px; /* Centraliza o thumb na trilha */
        box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff, inset -2px -2px grey, inset 2px 2px #dfdfdf;
        border: 1px solid #0a0a0a;
    }
    #volumeSlider::-moz-range-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: silver;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #fff;
        border-left: 1px solid grey;
        border-top: 1px solid grey;
        box-shadow: inset 1px 1px 0px #0a0a0a;
    }
    #volumeSlider::-moz-range-thumb {
        height: 20px;
        width: 15px;
        background: silver;
        cursor: pointer;
        border-radius: 0;
        box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #fff, inset -2px -2px grey, inset 2px 2px #dfdfdf;
        border: 1px solid #0a0a0a;
    }


    p#label { display: inline-block; width: fit-content; margin-right: 5px; font-size: 12px; }
    p#text { display: inline-block; background-color: #fff; padding: 4px; width: 85%; text-align: left; font-size: 12px; }
    p#text.artist:after { content: var(--artist); }
    p#text.title:after { content: var(--title); }
    .title, .artist { height: 23px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; padding-right: 20px!important; vertical-align: bottom; }
    
    .status-bar { gap: 1px; margin: 0 1px; }
    .status-bar-field { box-shadow: inset -1px -1px #dfdfdf, inset 1px 1px grey; flex-grow: 1; margin: 0; padding: 2px 3px; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- SELETORES DE ELEMENTOS ---
        const cdPlayerWindow = document.getElementById('cdPlayerWindow');
        const playButton = document.getElementById('playButton');
        const pauseButton = document.getElementById('pauseButton');
        const stopButton = document.getElementById('stopButton');
        const nextButton = document.getElementById('nextTrackButton');
        const previousButton = document.getElementById('previousTrackButton');
        const ejectButton = document.getElementById('ejectButton');
        const timeDisplay = document.getElementById('text2');
        const totalPlayDisplay = document.querySelector('.status-bar-field:first-child');
        const trackTimeDisplay = document.querySelector('.status-bar-field:last-child');
        const volumeControl = document.querySelector('.volume-control');
        const volumeSlider = document.getElementById('volumeSlider');
        const fileInput = document.getElementById('fileInput');
        const menuAddMusic = document.getElementById('menuAddMusic');

        const playlist = [
            { artist: "Devon Hendryx", title: "Missing Image File", url: "Missing image file..mp3", albumCoverUrl: "https://m.media-amazon.com/images/I/71NmRa8Sp7L._AC_SL1500_.jpg" },
            { artist: "Radiohead", title: "Jigsaw Falling Into Place", url: "Radiohead - Jigsaw Falling into Place [HD].mp3", albumCoverUrl: "https://m.media-amazon.com/images/I/A1MwaIeBpwL._AC_SX679_.jpg" },
            { artist: "Death Grips", title: "I've Seen Footage", url: "Death Grips - I've Seen Footage.mp3", albumCoverUrl: "https://imusic.b-cdn.net/images/item/original/119/0886919635119.jpg?death-grips-2012-the-money-store-lp&class=scaled&v=1647319621" },
            { artist: "Dean Blunt", title: "19 (feat. A$AP Rocky & Sauce Walka)", url: "19.mp3", albumCoverUrl: "https://m.media-amazon.com/images/I/41BhfHxlbIL._UX358_FMwebp_QL85_.jpg" },
            { artist: "Ecco2k", title: "Fragile", url: "Ecco2K - Fragile (Official Audio).mp3", albumCoverUrl: "https://lastfm.freetls.fastly.net/i/u/770x0/a15ce3e3c915faa4b90d6fb155359506.jpg#a15ce3e3c915faa4b90d6fb155359506" }
        ];
        
        const audio = new Audio();
        let currentTrackIndex = 0;
        let isPlaying = false;
        
        let isShuffle = false;
        let isContinuous = true;
        
        function updateDisplay(isEjected = false) {
            const root = document.documentElement;
            if (isEjected) {
                root.style.setProperty('--artist', `"No Disc"`);
                root.style.setProperty('--title', `""`);
                root.style.setProperty('--albumcover', `none`);
                timeDisplay.textContent = `[--] --:--`;
                totalPlayDisplay.textContent = 'Total Play: --:-- m:s';
                trackTimeDisplay.textContent = 'Track: --:-- m:s';
            } else {
                const currentTrack = playlist[currentTrackIndex];
                root.style.setProperty('--artist', `"${currentTrack.artist}"`);
                root.style.setProperty('--title', `"${currentTrack.title}"`);
                root.style.setProperty('--albumcover', `url('${currentTrack.albumCoverUrl}')`);
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return "00:00";
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function playMusic() {
            if (!audio.src || audio.src.includes('about:blank')) {
                loadTrack(0, true);
            } else {
                audio.play();
                isPlaying = true;
            }
        }

        function pauseMusic() { audio.pause(); isPlaying = false; }
        
        function stopMusic() {
            audio.pause(); audio.currentTime = 0; isPlaying = false;
            timeDisplay.textContent = `[${String(currentTrackIndex + 1).padStart(2, '0')}] 00:00`;
            trackTimeDisplay.textContent = `Track: 00:00 m:s`;
        }
        
        function loadTrack(trackIndex, autoplay = false) {
            currentTrackIndex = trackIndex;
            audio.src = playlist[currentTrackIndex].url;
            updateDisplay();
            if (autoplay) {
                audio.play(); isPlaying = true;
            }
        }

        function nextTrack() {
            let newIndex;
            if (isShuffle) {
                do { newIndex = Math.floor(Math.random() * playlist.length); } while (playlist.length > 1 && newIndex === currentTrackIndex);
            } else {
                newIndex = (currentTrackIndex + 1) % playlist.length;
            }
            loadTrack(newIndex, true);
        }

        function previousTrack() {
             const newIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack(newIndex, true);
        }

        function ejectDisc() {
            stopMusic(); audio.src = ''; updateDisplay(true);
        }

        // --- EVENT LISTENERS DO PLAYER ---
        playButton.addEventListener('click', playMusic);
        pauseButton.addEventListener('click', pauseMusic);
        stopButton.addEventListener('click', stopMusic);
        nextButton.addEventListener('click', nextTrack);
        previousButton.addEventListener('click', previousTrack);
        ejectButton.addEventListener('click', ejectDisc);
        
        audio.addEventListener('timeupdate', () => {
            if (isPlaying) {
                const { currentTime, duration } = audio;
                totalPlayDisplay.textContent = `Total Play: ${formatTime(duration)} m:s`;
                trackTimeDisplay.textContent = `Track: ${formatTime(currentTime)} m:s`;
                timeDisplay.textContent = `[${String(currentTrackIndex + 1).padStart(2, '0')}] ${formatTime(currentTime)}`;
            }
        });
        
        audio.addEventListener('ended', () => {
            if (isContinuous) { nextTrack(); } else { stopMusic(); isPlaying = false; }
        });

        volumeSlider.addEventListener('input', (e) => { audio.volume = e.target.value; });
        
        // --- LÓGICA DOS MENUS ---
        const menuItems = document.querySelectorAll('.menu-item');
        function closeAllMenus() {
            menuItems.forEach(item => item.classList.remove('active'));
        }

        menuItems.forEach(item => {
            item.querySelector('span').addEventListener('click', (event) => {
                event.stopPropagation();
                const wasActive = item.classList.contains('active');
                closeAllMenus();
                if (!wasActive) item.classList.add('active');
            });
        });

        // Disc
        document.getElementById('menuEject').addEventListener('click', () => { ejectDisc(); closeAllMenus(); });
        menuAddMusic.addEventListener('click', () => {
            fileInput.click();
            closeAllMenus();
        });
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileURL = URL.createObjectURL(file);
                const title = file.name.replace(/\.[^/.]+$/, ""); 
                const newTrack = {
                    artist: "Artista Desconhecido",
                    title: title,
                    url: fileURL,
                    albumCoverUrl: "https://images2.imgbox.com/42/89/JIRoQjUo_o.png"
                };
                playlist.push(newTrack);
                loadTrack(playlist.length - 1, true);
                fileInput.value = '';
            }
        });
        
        // View
        document.getElementById('menuViewNormal').addEventListener('click', () => {
            cdPlayerWindow.classList.remove('compact');
            volumeControl.classList.remove('active');
            closeAllMenus();
        });
        document.getElementById('menuViewCompact').addEventListener('click', () => {
            cdPlayerWindow.classList.add('compact');
            volumeControl.classList.remove('active');
            closeAllMenus();
        });
        document.getElementById('menuViewVolume').addEventListener('click', () => {
            volumeControl.classList.toggle('active');
            closeAllMenus();
        });

        // Options
        const randomCheck = document.querySelector('#menuOptRandom .checkmark');
        document.getElementById('menuOptRandom').addEventListener('click', () => {
            isShuffle = !isShuffle;
            randomCheck.classList.toggle('active', isShuffle);
            randomCheck.innerHTML = isShuffle ? '✓' : '';
            closeAllMenus();
        });

        const continuousCheck = document.querySelector('#menuOptContinuous .checkmark');
        document.getElementById('menuOptContinuous').addEventListener('click', () => {
            isContinuous = !isContinuous;
            continuousCheck.classList.toggle('active', isContinuous);
            continuousCheck.innerHTML = isContinuous ? '✓' : '';
            closeAllMenus();
        });
        
        document.getElementById('menuOptPrefs').addEventListener('click', () => {
            alert('Preferences window would open here.');
            closeAllMenus();
        });

        window.addEventListener('click', closeAllMenus);
        
        updateDisplay();
    });
</script>

</body>
</html>